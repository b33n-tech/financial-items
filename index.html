<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Items Budgeting App - Visual</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 20px; }
h1 { text-align: center; color: #333; }
.category { background: #fff; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
button.item-btn { font-size: 24px; padding: 20px 40px; margin: 10px; border: none; border-radius: 12px; cursor: pointer; color: white; }
button.item-btn:disabled { background: #aaa; cursor: not-allowed; }
.progress-bar { height: 25px; border-radius: 12px; background: #ddd; margin-top: 10px; overflow: hidden; }
.progress-fill { height: 100%; background: #28a745; text-align: center; color: white; line-height: 25px; font-weight: bold; transition: width 0.3s; }
.history { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 20px; max-height: 250px; overflow-y: auto;}
</style>
</head>
<body>

<h1>Items Budgeting App - Visuel</h1>

<div id="categories"></div>

<button onclick="resetAll()" style="font-size:18px; padding:10px 20px; margin-top:15px;">Réinitialiser tout</button>

<div class="history">
<h2>Historique</h2>
<ul id="historyList"></ul>
</div>

<script>
// --- Données initiales ---
let defaultCategories = [
    { name: "Burgers", total: 3, remaining: 3, color: "#007bff", unitLabel: "burger" },
    { name: "Equipement", total: 3, remaining: 3, color: "#dc3545", unitLabel: "equip" },
    { name: "Bonbons", total: 20, remaining: 20, color: "#ffc107", unitLabel: "bonbon" }
];

let categories = JSON.parse(localStorage.getItem('categories')) || defaultCategories;
let history = JSON.parse(localStorage.getItem('history')) || [];

function saveState() {
    localStorage.setItem('categories', JSON.stringify(categories));
    localStorage.setItem('history', JSON.stringify(history));
}

// --- Affichage catégories ---
function renderCategories() {
    const container = document.getElementById('categories');
    container.innerHTML = '';
    categories.forEach((cat, index) => {
        const div = document.createElement('div');
        div.className = 'category';
        div.innerHTML = `<h2>${cat.name} — ${cat.remaining}/${cat.total} ${cat.unitLabel}</h2>`;
        
        const btn = document.createElement('button');
        btn.className = 'item-btn';
        btn.style.backgroundColor = cat.color;
        btn.textContent = `+1 ${cat.unitLabel}`;
        btn.disabled = cat.remaining <= 0;
        btn.onclick = () => addItem(index, 1);
        div.appendChild(btn);
        
        // Progress bar
        const bar = document.createElement('div');
        bar.className = 'progress-bar';
        const fill = document.createElement('div');
        fill.className = 'progress-fill';
        const percent = Math.round((cat.total - cat.remaining)/cat.total * 100);
        fill.style.width = percent + '%';
        fill.style.backgroundColor = cat.color;
        fill.textContent = `${percent}%`;
        bar.appendChild(fill);
        div.appendChild(bar);
        
        container.appendChild(div);
    });
}

// --- Ajouter item ---
function addItem(catIndex, qty) {
    const cat = categories[catIndex];
    const actualQty = Math.min(qty, cat.remaining);
    cat.remaining -= actualQty;
    const now = new Date().toLocaleString();
    history.unshift({ category: cat.name, qty: actualQty, timestamp: now });
    saveState();
    renderCategories();
    renderHistory();
}

// --- Historique ---
function renderHistory() {
    const ul = document.getElementById('historyList');
    ul.innerHTML = '';
    history.forEach(h => {
        const li = document.createElement('li');
        li.textContent = `${h.timestamp}: ${h.qty} ${h.category}`;
        ul.appendChild(li);
    });
}

// --- Reset ---
function resetAll() {
    if(confirm("Confirmez-vous la réinitialisation de tout ?")) {
        categories = defaultCategories.map(c => ({ ...c, remaining: c.total }));
        history = [];
        saveState();
        renderCategories();
        renderHistory();
    }
}

// --- Initial render ---
renderCategories();
renderHistory();
</script>

</body>
</html>
